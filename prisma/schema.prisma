generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

model category {
  id                 Int                @id @default(autoincrement())
  title              String             @unique
  description        String?            @db.Text
  place_categories   place_category[]
  crawler_categories crawler_category[]
}

model place {
  id               Int              @id @default(autoincrement())
  name             String
  province         String?
  city             String?
  address          String?
  lat              Float?
  lon              Float?
  geohash          String?
  extra_info       Json?
  place_categories place_category[]

  @@index([geohash])
}

model place_category {
  id          Int      @id @default(autoincrement())
  place_id    Int
  category_id Int
  place       place    @relation(fields: [place_id], references: [id])
  category    category @relation(fields: [category_id], references: [id])

  @@unique([category_id, place_id])
}

model crawler {
  id                 Int                        @id @default(autoincrement())
  origin_url         String                     @unique
  origin_title       String?
  checksum           String?
  need_manual_edit   Boolean                    @default(false)
  last_updated_at    DateTime?
  crawler_categories crawler_category[]
  parents            crawler_parent_and_child[]

  @@index([last_updated_at])
}

model gsimuni {
  id                Int    @id @default(autoincrement())
  prefecture_number Int
  prefecture_name   String
  municd            Int    @unique
  municipality      String
}

model crawler_category {
  id          Int      @id @default(autoincrement())
  crawler_id  Int
  category_id Int
  crawler     crawler  @relation(fields: [crawler_id], references: [id])
  category    category @relation(fields: [category_id], references: [id])

  @@unique([crawler_id, category_id])
}

model crawler_root {
  id          Int                        @id @default(autoincrement())
  url         String                     @unique
  search_word String?
  childlen    crawler_parent_and_child[]
}

model crawler_parent_and_child {
  id              Int          @id @default(autoincrement())
  crawler_id      Int
  crawler_root_id Int
  crawler         crawler      @relation(fields: [crawler_id], references: [id])
  crawler_root    crawler_root @relation(fields: [crawler_root_id], references: [id])

  @@unique([crawler_root_id, crawler_id])
}
